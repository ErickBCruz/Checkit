{% extends "base.html" %} {% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="../static/js/typed-landing.js"></script>
    <title>Inicio</title>
  </head>
  <body>
    {% block nav %} {% include "partials/_nav.html" %} {% endblock nav %}
    {%block content %}
    <div class="container p-4">
      <div class="d-flex flex-row justify-content-between align-items-center">
        <div class="container pt-5 mb-10">
          <h1 class="display-3 fw-bolder">
            <span>Conectando</span> <br />
            <span style="color: #b60636" id="typed-element">Empresas</span>
          </h1>
          <h4 class="fw-lighter">
            <span style="color: #FFFFF"
              >Transformando la Reparaci√≥n de Dispositivos</span
            >
          </h4>
          <div class="pt-2 mt-5">
            <a href="{% url "register-enterprise" %}" class="btn btn-danger me-4">Soy empresa/t√©cnico</a>
            <a href="{% url "register-client" %}" class="btn btn-secondary">Reparar mi dispositivo</a>
          </div>
        </div>

        <img
          src="{% static 'svg/lading-page-header-image.svg' %}"
          alt="person-repairing-a-tech-device"
          width="50%"
          draggable="false"
        />
      </div>

      <div class="mb-10 mt-5">
        <h3>Ingresar ticket de reparaci√≥n</h3>
        <p class="lead mt-3 fs-6">
          Si ya tienes un ticket de reparaci√≥n, puedes ingresar el c√≥digo aqu√≠
          para ver el estado de tu reparaci√≥n.
        </p>
        <form method="POST">
          {% csrf_token %}
          <div class="input-group mb-3">
            <input
              type="text"
              class="form-control rounded-2"
              placeholder="C√≥digo de ticket"
              aria-label="C√≥digo de ticket"
              aria-describedby="button-addon2"
              name="ticket"
              value="{{ ticket.ticket| default:"" }}"
              required
            />
            <button
              class="btn btn-outline-secondary"
              type="submit"
              id="button-addon2"
            >
              Buscar
            </button>
          </div>
          {% if ticket %}
          <div class="alert alert-success" role="alert">
            <h4 class="alert-heading">Estado de tu reparaci√≥n</h4>
            <p>
              El estado de tu reparaci√≥n se encuentra <strong>
                {% if ticket.status == "1" %}
                Pendiente por confirmar ü§î
                {% elif ticket.status == "2" %}
                En reparaci√≥n üõ†Ô∏è
                {% elif ticket.status == "3" %}
                Finalizado ‚úÖ
                {% else %}
                Cancelado ‚ùå
                {% endif %}
              </strong>
            </p>
            <p class="mb-0">
              <strong>Dispositivo:</strong> {{ ticket.device.name }}
            </p>
            <p class="mb-0">
              <strong>Raz√≥n de mantenimiento:</strong> {{ ticket.reason }}
            </p>
            <p class="mb-0">
              <strong>Empresa de reparaci√≥n:</strong> {{ ticket.enterprise.enterprise_name }}
            </p>
            <hr />
            <p class="mb-0">
              <strong>Fecha de creaci√≥n:</strong> {{ ticket.created_at }}
            </p>
            {% if ticket.status == "En reparaci√≥n" %}
            <p class="mb-0">
              <strong>Fecha estimada de finalizaci√≥n:</strong>
              {{ ticket.deadline }}
            </p>
            {% endif %}
          </div>
          {% endif %}
      </div>

      {% if  messages %}
      {% for message in messages %}
      <div class="alert alert-error" role="alert">
        <div class="alert alert-warning" role="alert">
          <h4 class="alert-heading">Error al ingresar el c√≥digo</h4>
          <p>
            Lo sentimos, no se encontr√≥ ning√∫n ticket con el c√≥digo ingresado.
          </p>
        </div>
      </div>
      {% endfor %}
    
      {% endif %}

      <div class="mt-5">
        <h3>Filtros de b√∫squeda de empresas de reparaci√≥n</h3>
      </div>

      <div class="w-25 mt-5 mb-5 bg-light p-3 rounded-3 p-4 w-100">
      <form method="GET" action="{% url "index" %}">
          <label class="form-label" for="customRange2">Distancia de b√∫squeda</label>  
        <div class="range w-25">
          <input type="range" class="form-range" value="{{ distance }}" min="1" max="10" 
          name="distance-range" id="customRange2" oninput="this.nextElementSibling.value = this.value" />

          <output>
            {{ distance }}
          </output>

        </div>
        <button type="submit" class="btn btn-primary mt-3">Buscar</button>
      </form>
    </div>

    {% if  near_enterprises_count == 0 and near_technicians_count == 0 %}

    <div class="alert alert-danger mt-5" role="alert">
      No se encontraron empresas ni t√©cnicos a menos de <strong>{{ distance }} km</strong> de tu ubicaci√≥n.
    </div>

    {% else %}
    <div class="alert alert-success mt-5" role="alert">
      Se encontraron <strong>{{ near_enterprises_count }} empresas</strong> y 
      <strong>{{ near_technicians_count }} t√©cnicos</strong>
      a menos de <strong>{{ distance }} km</strong> de tu ubicaci√≥n.
    </div>
    
    {% endif %}


    <div class="d-flex flex-col mt-5">
        <div class="col-md-12">{{map | safe}}</div>
      </div>
    </div>
  
    <script>
      const typed = new Typed("#typed-element", {
        strings: ["Empresas", "T√©cnicos", "Clientes"],
        typeSpeed: 100,
        backSpeed: 100,
        backDelay: 1000,
        fadeOut: true,
        loop: true,
      });

      navigator.geolocation.getCurrentPosition(function (position) {
        const geolocation = {
          lat: position.coords.latitude,
          lng: position.coords.longitude,
        }
        document.cookie = `geolocation=${JSON.stringify(geolocation)}; path=/;`;
    });
    
    </script>
    {% endblock %}
  </body>
</html>
